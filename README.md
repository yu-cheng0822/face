# 人臉辨識門禁系統 (Face Recognition Access Control System)

## 專案簡介

這是一個基於深度學習的人臉辨識門禁系統，使用 Qt 和 OpenCV 開發。系統能夠即時偵測和辨識人臉，並根據辨識結果控制門禁開關。

## 主要功能

### 1. 即時人臉偵測
- 使用 SSD (Single Shot Detector) 深度學習模型進行即時人臉偵測
- 偵測信心度閾值設定為 0.6，確保偵測準確性
- 在視訊畫面中以綠色方框標示偵測到的人臉

### 2. 人臉註冊系統
- 支援新使用者註冊功能
- 自動擷取攝影機畫面中的人臉
- 使用 OpenFace 模型提取 128 維人臉特徵向量
- 將使用者資料（姓名和特徵向量）儲存至 SQLite 資料庫

### 3. 人臉辨識與門禁控制
- 即時辨識攝影機畫面中的人臉
- 使用歐氏距離計算特徵向量相似度（閾值：0.8）
- 辨識成功後自動開啟門禁 3 秒鐘
- 顯示授權狀態和使用者 ID

### 4. 使用者管理
- 支援刪除已註冊的使用者
- 提供使用者名稱搜尋和刪除功能
- 即時更新資料庫

## 技術架構

### 開發框架
- **Qt 5/6**: 圖形化使用者介面框架
- **OpenCV 4.12.0**: 電腦視覺和深度學習函式庫

### 深度學習模型
1. **人臉偵測模型**: `res10_300x300_ssd_iter_140000.caffemodel`
   - 基於 SSD 的人臉偵測網路
   - 輸入尺寸: 300x300
   - 使用 Caffe 框架訓練

2. **人臉嵌入模型**: `openface.nn4.small2.v1.t7`
   - OpenFace 人臉特徵提取網路
   - 輸出 128 維特徵向量
   - 使用 Torch 格式

### 資料庫
- **SQLite**: 輕量級關聯式資料庫
- 儲存使用者 ID、姓名和 128 維特徵向量

## 系統需求

### 軟體需求
- Qt 5 或更高版本（需要 widgets 和 sql 模組）
- OpenCV 4.12.0 或相容版本
- C++17 編譯器
- SQLite 資料庫

### 硬體需求
- 網路攝影機或 USB 攝影機
- Windows 作業系統（目前設定檔針對 Windows + MSVC）

## 安裝說明

### 1. 安裝 Qt
下載並安裝 Qt 開發框架：
```
https://www.qt.io/download
```

### 2. 安裝 OpenCV
1. 下載 OpenCV 4.12.0
2. 安裝至 `C:/opencv/` 目錄（或修改 `face.pro` 中的路徑）

### 3. 準備深度學習模型檔案
確保以下檔案位於專案根目錄：
- `deploy.prototxt` - 人臉偵測模型配置檔
- `res10_300x300_ssd_iter_140000.caffemodel` - 人臉偵測模型權重
- `openface.nn4.small2.v1.t7` - 人臉嵌入模型

### 4. 編譯專案
```bash
qmake face.pro
make
```

或使用 MSVC：
```bash
msvc_make.bat
```

## 使用說明

### 啟動應用程式
1. 執行編譯後的程式
2. 系統會自動開啟攝影機並顯示即時畫面
3. 預設門禁狀態為「鎖定」(Door Locked)

### 註冊新使用者
1. 在「註冊使用者」欄位輸入使用者姓名
2. 面對攝影機，確保人臉清晰可見
3. 點擊「註冊使用者」按鈕
4. 系統會自動擷取人臉並儲存至資料庫
5. 註冊成功後會顯示「Registered: [姓名]」

### 使用門禁系統
1. 已註冊的使用者面對攝影機
2. 系統自動偵測並辨識人臉
3. 辨識成功後顯示「Authorized」和使用者 ID
4. 門禁自動開啟 3 秒鐘
5. 未辨識到授權人臉時，門禁保持鎖定狀態

### 刪除使用者
1. 在「刪除使用者」欄位輸入要刪除的使用者姓名
2. 點擊「刪除使用者」按鈕
3. 系統會從資料庫中移除該使用者的所有資料

## 專案檔案結構

```
face/
├── main.cpp                          # 程式進入點
├── mainwindow.cpp                    # 主視窗邏輯實作
├── mainwindow.h                      # 主視窗類別定義
├── mainwindow.ui                     # Qt 使用者介面設計檔
├── face.pro                          # Qt 專案配置檔
├── deploy.prototxt                   # 人臉偵測模型配置
├── res10_300x300_ssd_iter_140000.caffemodel  # 人臉偵測模型
├── openface.nn4.small2.v1.t7        # 人臉嵌入模型
├── haarcascade_frontalface_default.xml  # Haar 級聯分類器（備用）
├── users.db                          # SQLite 使用者資料庫
└── README.md                         # 專案說明文件
```

## 核心演算法

### 人臉偵測流程
1. 從攝影機擷取視訊幀
2. 將圖片轉換為 300x300 blob
3. 輸入至 SSD 模型進行推論
4. 過濾信心度低於 0.6 的偵測結果
5. 繪製邊界框並提取人臉 ROI

### 人臉辨識流程
1. 將偵測到的人臉調整為 96x96 尺寸
2. 正規化像素值（除以 255）
3. 輸入至 OpenFace 模型獲得 128 維特徵向量
4. 與資料庫中所有使用者的特徵向量計算歐氏距離
5. 距離小於 0.8 視為同一人

### 資料庫架構
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT,
    v1 REAL, v2 REAL, ..., v128 REAL  -- 128維特徵向量
);
```

## 技術特點

1. **即時處理**: 使用 QTimer 每 60 毫秒更新一次畫面
2. **深度學習加速**: 支援 OpenCV DNN 模組的硬體加速
3. **自動門禁控制**: 智慧計時器管理門禁開關狀態
4. **資料持久化**: 使用 SQLite 儲存使用者資料
5. **友善介面**: Qt Widgets 提供直觀的圖形化介面

## 注意事項

1. 首次執行時會自動建立 `users.db` 資料庫
2. 系統會在啟動時清空現有的使用者資料表
3. 攝影機預設使用設備 ID 0（系統預設攝影機）
4. 模型檔案路徑需要正確設定，否則系統無法啟動
5. 光線條件會影響人臉偵測和辨識的準確度

## 開發者資訊

此專案使用 C++17 標準開發，採用 Qt 的信號槽機制處理事件，並整合 OpenCV 深度學習模組實現人臉辨識功能。

## 授權

請依照專案實際使用的授權條款。

## 未來改進方向

- [ ] 支援多人同時辨識
- [ ] 增加人臉活體檢測（防止照片攻擊）
- [ ] 優化辨識速度和準確度
- [ ] 加入訪問記錄功能
- [ ] 支援遠端管理和監控
- [ ] 增加使用者權限管理